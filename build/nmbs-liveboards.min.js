"use strict";angular.module("ui-nmbs-liveboards",["NmbsFilters"]).directive("nmbsLiveboards",["$http",function(a){return{restrict:"A",template:'<div class="nmbsLiveboards"><div ng-if="!selectedStation" class="selectStation"><p>Select a station</p><select ng-model="selectedStation" ng-options="s.name for s in stations" ng-change="update(selectedStation)"></select></div><div ng-if="showLoader" class="loader"></div><div ng-if="errorMessage" class="error">{{errorMessage}}</div><div ng-if="received" class="liveBoard"><div class="stationData"><h1>{{liveBoard.location.name}}</h1></div><table class="departures"><thead><tr><th colspan="5">test</th></tr></thead><tbody><tr class="departure" ng-repeat="departure in liveBoard.departures"><td class="time">{{departure.iso8601 | timeFilter}}</td><td class="direction">{{departure.direction}}</td><td class="type">{{departure.vehicle | vehicleTypeFilter}}</td><td class="platform">{{departure.platform.name}}</td><td ng-if="departure.delay" class="delay">+{{departure.delay | delayFilter}}</td></tr></tbody></table></div></div>{{foobar.value}}',scope:{station:"="},controller:function(b){b.selectedStation=angular.isUndefined(b.station)?!1:!0,b.activeStation=!1,b.liveBoard=null,b.received=!1,b.showLoader=!1,b.errorMessage="",a.get("https://data.irail.be/NMBS/Stations.json").success(function(a){if(b.stations=a.Stations,!angular.isUndefined(b.station))for(var c=0;c<a.Stations.length;++c)if(a.Stations[c].name===b.station){b.update(a.Stations[c]);break}}),b.update=function(c){b.selectedStation=c,b.showLoader=!0,a.get(c.departures+".json").success(function(a){b.liveBoard=a.Liveboard,b.received=!0})},b.$watch("received",function(a){a&&(b.showLoader=!1)})}}}]),angular.module("NmbsFilters",[]).filter("vehicleTypeFilter",function(){return function(a){var b=a.split(".");return b[2].replace(/(\d+)/g,"")}}).filter("timeFilter",function(){return function(a){var b=new Date(a);return b.toLocaleTimeString("be-BE")}}).filter("delayFilter",function(){return function(a){var b=parseInt(a/3600,10)%24,c=parseInt(a/60,10)%60;return(10>b?"0"+b:b)+"h"+(10>c?"0"+c:c)}});