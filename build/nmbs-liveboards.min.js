"use strict";angular.module("ui-nmbs-liveboards",["irailApiServices","NmbsFilters"]).directive("nmbsLiveboards",["Nmbs",function(a){return{restrict:"A",template:'<div class="nmbsLiveboards"><div ng-if="!selectedStation" class="selectStation"><p>Select a station</p><select ng-model="selectedStation" ng-options="s.name for s in stations" ng-change="update(selectedStation)"></select></div><div ng-if="!received" class="loader"></div><div ng-if="received" class="liveBoard"><div class="stationData"><h1>{{liveBoard.location.name}}</h1></div><table class="departures"><thead><tr><th colspan="5">test</th></tr></thead><tbody><tr class="departure" ng-repeat="departure in liveBoard.departures"><td class="time">{{departure.iso8601 | timeFilter}}</td><td class="direction">{{departure.direction}}</td><td class="type">{{departure.vehicle | vehicleTypeFilter}}</td><td class="platform">{{departure.platform.name}}</td><td ng-if="departure.delay" class="delay">+{{departure.delay | delayFilter}}</td></tr></tbody></table></div></div>{{foobar.value}}',scope:{station:"="},controller:function(b){b.selectedStation=angular.isUndefined(b.station)?!1:!0,b.activeStation=!1,b.liveBoard=[],b.received=!1,a.getStations().then(function(a){if(b.stations=a.Stations,!angular.isUndefined(b.station)){for(var c=0;c<a.Stations.length;++c)if(a.Stations[c].name===b.station){b.activeStation=a.Stations[c];break}b.update(b.activeStation)}}),b.update=function(c){b.selectedStation=c,a.getLiveboard(c).then(function(a){b.liveBoard=a.Liveboard,b.received=!0})}}}}]),angular.module("irailApiServices",[]).service("Nmbs",["$http",function(a){this.getStations=function(){return this.getData("https://data.irail.be/NMBS/Stations.json")},this.getLiveboard=function(a){return this.getData(a.departures+".json")},this.getData=function(b){var c=a.get(b).then(function(a){return a.data});return c}}]),angular.module("NmbsFilters",[]).filter("vehicleTypeFilter",function(){return function(a){var b=a.split(".");return b[2]}}).filter("timeFilter",function(){return function(a){var b=new Date(a);return b.toLocaleTimeString("be-BE")}}).filter("delayFilter",function(){return function(a){var b=parseInt(a/3600,10)%24,c=parseInt(a/60,10)%60;return(10>b?"0"+b:b)+"h"+(10>c?"0"+c:c)}});